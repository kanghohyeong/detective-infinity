"use strict";(self.webpackChunkai_detective=self.webpackChunkai_detective||[]).push([[331,795],{3331:function(e,t,r){r.r(t),r.d(t,{VectorDBQAChain:function(){return M}});var n=r(4165),a=r(1413),i=r(5861),u=r(5671),o=r(3144),s=r(7326),c=r(136),l=r(9388),p=r(4897),f=r(4441),m=r(794),h=r(4757),v=r(3433),b=r(7762),d=r(8659),Z=r(8799),y=function(){function e(){(0,u.Z)(this,e)}return(0,o.Z)(e,[{key:"serialize",value:function(){return(0,a.Z)({_type:this.constructor.name},JSON.parse(JSON.stringify(this)))}}]),e}(),w=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,u.Z)(this,r),n=t.call(this),Object.defineProperty((0,s.Z)(n),"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.messages=e,n}return(0,o.Z)(r,[{key:"toString",value:function(){return JSON.stringify(this.messages)}},{key:"toChatMessages",value:function(){return this.messages}}]),r}(d.MJ),x=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,u.Z)(this,r),n=t.call(this),Object.defineProperty((0,s.Z)(n),"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.prompt=e,n}return(0,o.Z)(r,[{key:"inputVariables",get:function(){return this.prompt.inputVariables}},{key:"formatMessages",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.format(t);case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(y),k=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){return(0,u.Z)(this,r),t.call(this,e)}return(0,o.Z)(r,[{key:"format",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.formatPromptValue(t);case 2:return e.abrupt("return",e.sent.toString());case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"formatPromptValue",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.formatMessages(t);case 2:return r=e.sent,e.abrupt("return",new w(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(Z.dy),g=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){return(0,u.Z)(this,r),t.call(this,e)}return(0,o.Z)(r,[{key:"format",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d.Z,e.next=3,this.prompt.format(t);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"fromTemplate",value:function(e){return new this(h.PromptTemplate.fromTemplate(e))}}]),r}(x),P=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){return(0,u.Z)(this,r),t.call(this,e)}return(0,o.Z)(r,[{key:"format",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d.w,e.next=3,this.prompt.format(t);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"fromTemplate",value:function(e){return new this(h.PromptTemplate.fromTemplate(e))}}]),r}(x),_=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;if((0,u.Z)(this,r),n=t.call(this,e),Object.defineProperty((0,s.Z)(n),"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,s.Z)(n),"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign((0,s.Z)(n),e),n.validateTemplate){var a,i=new Set,o=(0,b.Z)(n.promptMessages);try{for(o.s();!(a=o.n()).done;){var c,l=a.value,p=(0,b.Z)(l.inputVariables);try{for(p.s();!(c=p.n()).done;){var f=c.value;i.add(f)}}catch(Z){p.e(Z)}finally{p.f()}}}catch(Z){o.e(Z)}finally{o.f()}var m=new Set(n.partialVariables?n.inputVariables.concat(Object.keys(n.partialVariables)):n.inputVariables),h=new Set((0,v.Z)(m).filter((function(e){return!i.has(e)})));if(h.size>0)throw new Error("Input variables `".concat((0,v.Z)(h),"` are not used in any of the prompt messages."));var d=new Set((0,v.Z)(i).filter((function(e){return!m.has(e)})));if(d.size>0)throw new Error("Input variables `".concat((0,v.Z)(d),"` are used in prompt messages but not in the prompt template."))}return n}return(0,o.Z)(r,[{key:"_getPromptType",value:function(){return"chat"}},{key:"formatMessages",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,a,i,u,o,s,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mergePartialAndUserVariables(t);case 2:r=e.sent,a=[],i=(0,b.Z)(this.promptMessages),e.prev=5,i.s();case 7:if((u=i.n()).done){e.next=16;break}return o=u.value,s=o.inputVariables.reduce((function(e,t){if(!(t in r))throw new Error("Missing value for input variable `".concat(t,"`"));return e[t]=r[t],e}),{}),e.next=12,o.formatMessages(s);case 12:c=e.sent,a=a.concat(c);case 14:e.next=7;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(5),i.e(e.t0);case 21:return e.prev=21,i.f(),e.finish(21);case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this,[[5,18,21,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"serialize",value:function(){if(void 0!==this.outputParser)throw new Error("ChatPromptTemplate cannot be serialized if outputParser is set");return{input_variables:this.inputVariables,prompt_messages:this.promptMessages.map((function(e){return e.serialize()}))}}},{key:"partial",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var i,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(u=(0,a.Z)({},this)).inputVariables=this.inputVariables.filter((function(e){return!(e in t)})),u.partialVariables=(0,a.Z)((0,a.Z)({},null!==(i=this.partialVariables)&&void 0!==i?i:{}),t),e.abrupt("return",new r(u));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"fromPromptMessages",value:function(e){var t,n=e.reduce((function(e,t){return e.concat(t instanceof r?t.promptMessages:[t])}),[]),a=e.reduce((function(e,t){return t instanceof r?Object.assign(e,t.partialVariables):e}),Object.create(null)),i=new Set,u=(0,b.Z)(n);try{for(u.s();!(t=u.n()).done;){var o,s=t.value,c=(0,b.Z)(s.inputVariables);try{for(c.s();!(o=c.n()).done;){var l=o.value;l in a||i.add(l)}}catch(p){c.e(p)}finally{c.f()}}}catch(p){u.e(p)}finally{u.f()}return new r({inputVariables:(0,v.Z)(i),promptMessages:n,partialVariables:a})}}]),r}(k),V=r(9439),O=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(0,u.Z)(this,r),n=t.call(this),Object.defineProperty((0,s.Z)(n),"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,s.Z)(n),"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.defaultPrompt=e,n.conditionals=a,n}return(0,o.Z)(r,[{key:"getPrompt",value:function(e){var t,r=(0,b.Z)(this.conditionals);try{for(r.s();!(t=r.n()).done;){var n=(0,V.Z)(t.value,2),a=n[0],i=n[1];if(a(e))return i}}catch(u){r.e(u)}finally{r.f()}return this.defaultPrompt}}]),r}((0,o.Z)((function e(){(0,u.Z)(this,e)})));function S(e){return"base_chat_model"===e._modelType()}var j=new h.PromptTemplate({template:"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\n{context}\n\nQuestion: {question}\nHelpful Answer:",inputVariables:["context","question"]}),T=[P.fromTemplate("Use the following pieces of context to answer the users question. \nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\n----------------\n{context}"),g.fromTemplate("{question}")],D=new O(j,[[S,_.fromPromptMessages(T)]]);r(2795),r(9649);function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.prompt,n=void 0===r?D.getPrompt(e):r,a=t.verbose,i=new f.LLMChain({prompt:n,llm:e,verbose:a});return new m.StuffDocumentsChain({llmChain:i,verbose:a})}var M=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n,a,i,o;return(0,u.Z)(this,r),o=t.call(this,e),Object.defineProperty((0,s.Z)(o),"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty((0,s.Z)(o),"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty((0,s.Z)(o),"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,s.Z)(o),"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,s.Z)(o),"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),o.vectorstore=e.vectorstore,o.combineDocumentsChain=e.combineDocumentsChain,o.inputKey=null!==(n=e.inputKey)&&void 0!==n?n:o.inputKey,o.k=null!==(a=e.k)&&void 0!==a?a:o.k,o.returnSourceDocuments=null!==(i=e.returnSourceDocuments)&&void 0!==i?i:o.returnSourceDocuments,o}return(0,o.Z)(r,[{key:"inputKeys",get:function(){return[this.inputKey]}},{key:"outputKeys",get:function(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}},{key:"_call",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,u,o,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputKey in t){e.next=2;break}throw new Error("Question key ".concat(this.inputKey," not found."));case 2:return i=t[this.inputKey],e.next=5,this.vectorstore.similaritySearch(i,this.k);case 5:return u=e.sent,o={question:i,input_documents:u},e.next=9,this.combineDocumentsChain.call(o,null===r||void 0===r?void 0:r.getChild());case 9:if(s=e.sent,!this.returnSourceDocuments){e.next=12;break}return e.abrupt("return",(0,a.Z)((0,a.Z)({},s),{},{sourceDocuments:u}));case 12:return e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_chainType",value:function(){return"vector_db_qa"}},{key:"serialize",value:function(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}}],[{key:"deserialize",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,a){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("vectorstore"in a){e.next=2;break}throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");case 2:if(i=a.vectorstore,t.combine_documents_chain){e.next=5;break}throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");case 5:return e.t0=r,e.next=8,p.l.deserialize(t.combine_documents_chain);case 8:return e.t1=e.sent,e.t2=t.k,e.t3=i,e.t4={combineDocumentsChain:e.t1,k:e.t2,vectorstore:e.t3},e.abrupt("return",new e.t0(e.t4));case 13:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fromLLM",value:function(e,t,r){var n=C(e);return new this((0,a.Z)({vectorstore:t,combineDocumentsChain:n},r))}}]),r}(p.l)},2795:function(e,t,r){r.r(t),r.d(t,{FewShotPromptTemplate:function(){return v}});var n=r(3433),a=r(1413),i=r(4165),u=r(5861),o=r(5671),s=r(3144),c=r(7326),l=r(136),p=r(9388),f=r(8799),m=r(9649),h=r(4757),v=function(e){(0,l.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;if((0,o.Z)(this,r),n=t.call(this,e),Object.defineProperty((0,c.Z)(n),"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,c.Z)(n),"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,c.Z)(n),"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,c.Z)(n),"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty((0,c.Z)(n),"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty((0,c.Z)(n),"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty((0,c.Z)(n),"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty((0,c.Z)(n),"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign((0,c.Z)(n),e),void 0!==n.examples&&void 0!==n.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===n.examples&&void 0===n.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(n.validateTemplate){var a=n.inputVariables;n.partialVariables&&(a=a.concat(Object.keys(n.partialVariables))),(0,m.af)(n.prefix+n.suffix,n.templateFormat,a)}return n}return(0,s.Z)(r,[{key:"_getPromptType",value:function(){return"few_shot"}},{key:"getExamples",value:function(){var e=(0,u.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.examples){e.next=2;break}return e.abrupt("return",this.examples);case 2:if(void 0===this.exampleSelector){e.next=4;break}return e.abrupt("return",this.exampleSelector.selectExamples(t));case 4:throw new Error("One of 'examples' and 'example_selector' should be provided");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"partial",value:function(){var e=(0,u.Z)((0,i.Z)().mark((function e(t){var n,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(u=(0,a.Z)({},this)).inputVariables=this.inputVariables.filter((function(e){return!(e in t)})),u.partialVariables=(0,a.Z)((0,a.Z)({},null!==(n=this.partialVariables)&&void 0!==n?n:{}),t),e.abrupt("return",new r(u));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"format",value:function(){var e=(0,u.Z)((0,i.Z)().mark((function e(t){var r,a,u,o,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mergePartialAndUserVariables(t);case 2:return r=e.sent,e.next=5,this.getExamples(r);case 5:return a=e.sent,e.next=8,Promise.all(a.map((function(e){return s.examplePrompt.format(e)})));case 8:return u=e.sent,o=[this.prefix].concat((0,n.Z)(u),[this.suffix]).join(this.exampleSeparator),e.abrupt("return",(0,m.SM)(o,this.templateFormat,r));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialize",value:function(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}}],[{key:"deserialize",value:function(){var e=(0,u.Z)((0,i.Z)().mark((function e(t){var n,a,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.example_prompt){e.next=3;break}throw new Error("Missing example prompt");case 3:return e.next=5,h.PromptTemplate.deserialize(n);case 5:if(a=e.sent,!Array.isArray(t.examples)){e.next=10;break}u=t.examples,e.next=11;break;case 10:throw new Error("Invalid examples format. Only list or string are supported.");case 11:return e.abrupt("return",new r({inputVariables:t.input_variables,examplePrompt:a,examples:u,exampleSeparator:t.example_separator,prefix:t.prefix,suffix:t.suffix,templateFormat:t.template_format}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),r}(f.Al)}}]);
//# sourceMappingURL=331.335233fb.chunk.js.map