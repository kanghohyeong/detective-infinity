"use strict";(self.webpackChunkai_detective=self.webpackChunkai_detective||[]).push([[794],{794:function(e,t,n){n.r(t),n.d(t,{MapReduceDocumentsChain:function(){return Z},RefineDocumentsChain:function(){return k},StuffDocumentsChain:function(){return v}});var r=n(4165),i=n(4942),a=n(1413),u=n(4925),c=n(9142),o=n(5861),l=n(3433),s=n(5671),p=n(3144),m=n(7326),h=n(136),f=n(9388),b=n(4897),d=n(4441),y=n(4757),v=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,i,a;return(0,s.Z)(this,n),a=t.call(this,e),Object.defineProperty((0,m.Z)(a),"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,m.Z)(a),"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty((0,m.Z)(a),"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),a.llmChain=e.llmChain,a.documentVariableName=null!==(r=e.documentVariableName)&&void 0!==r?r:a.documentVariableName,a.inputKey=null!==(i=e.inputKey)&&void 0!==i?i:a.inputKey,a}return(0,p.Z)(n,[{key:"inputKeys",get:function(){return[this.inputKey].concat((0,l.Z)(this.llmChain.inputKeys))}},{key:"outputKeys",get:function(){return this.llmChain.outputKeys}},{key:"_call",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t,n){var o,l,s,p,m,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputKey in t){e.next=2;break}throw new Error("Document key ".concat(this.inputKey," not found."));case 2:return o=this.inputKey,l=t[o],s=(0,u.Z)(t,[o].map(c.Z)),p=l.map((function(e){return e.pageContent})),m=p.join("\n\n"),e.next=7,this.llmChain.call((0,a.Z)((0,a.Z)({},s),{},(0,i.Z)({},this.documentVariableName,m)),null===n||void 0===n?void 0:n.getChild());case 7:return h=e.sent,e.abrupt("return",h);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_chainType",value:function(){return"stuff_documents_chain"}},{key:"serialize",value:function(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}],[{key:"deserialize",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.llm_chain){e.next=2;break}throw new Error("Missing llm_chain");case 2:return e.t0=n,e.next=5,d.LLMChain.deserialize(t.llm_chain);case 5:return e.t1=e.sent,e.t2={llmChain:e.t1},e.abrupt("return",new e.t0(e.t2));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(b.l),Z=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,i,a,u,c,o,l;return(0,s.Z)(this,n),l=t.call(this,e),Object.defineProperty((0,m.Z)(l),"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,m.Z)(l),"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty((0,m.Z)(l),"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty((0,m.Z)(l),"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty((0,m.Z)(l),"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty((0,m.Z)(l),"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty((0,m.Z)(l),"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty((0,m.Z)(l),"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),l.llmChain=e.llmChain,l.combineDocumentChain=e.combineDocumentChain,l.documentVariableName=null!==(r=e.documentVariableName)&&void 0!==r?r:l.documentVariableName,l.ensureMapStep=null!==(i=e.ensureMapStep)&&void 0!==i?i:l.ensureMapStep,l.inputKey=null!==(a=e.inputKey)&&void 0!==a?a:l.inputKey,l.maxTokens=null!==(u=e.maxTokens)&&void 0!==u?u:l.maxTokens,l.maxIterations=null!==(c=e.maxIterations)&&void 0!==c?c:l.maxIterations,l.returnIntermediateSteps=null!==(o=e.returnIntermediateSteps)&&void 0!==o&&o,l}return(0,p.Z)(n,[{key:"inputKeys",get:function(){return[this.inputKey].concat((0,l.Z)(this.combineDocumentChain.inputKeys))}},{key:"outputKeys",get:function(){return this.combineDocumentChain.outputKeys}},{key:"_call",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t,n){var l,s,p,m,h,f,b,d,y,v=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputKey in t){e.next=2;break}throw new Error("Document key ".concat(this.inputKey," not found."));case 2:l=this.inputKey,s=t[l],p=(0,u.Z)(t,[l].map(c.Z)),m=s,h=[],f=(0,r.Z)().mark((function e(){var t,u,c,l,s,f,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=m.map((function(e){return(0,a.Z)((0,i.Z)({},v.documentVariableName,e.pageContent),p)})),u=t.map(function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.llmChain.prompt.format(t);case 2:return n=e.sent,e.abrupt("return",v.llmChain.llm.getNumTokens(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(u).then((function(e){return e.reduce((function(e,t){return e+t}),0)}));case 4:if(c=e.sent,l=0!==b||!v.ensureMapStep,s=c<v.maxTokens,!l||!s){e.next=9;break}return e.abrupt("return","break");case 9:return e.next=11,v.llmChain.apply(t,n?[n.getChild()]:void 0);case 11:f=e.sent,d=v.llmChain.outputKey,v.returnIntermediateSteps&&(h=h.concat(f.map((function(e){return e[d]})))),m=f.map((function(e){return{pageContent:e[d]}}));case 15:case"end":return e.stop()}}),e)})),b=0;case 7:if(!(b<this.maxIterations)){e.next=15;break}return e.delegateYield(f(),"t0",9);case 9:if("break"!==e.t0){e.next=12;break}return e.abrupt("break",15);case 12:b+=1,e.next=7;break;case 15:return d=(0,a.Z)({input_documents:m},p),e.next=18,this.combineDocumentChain.call(d,null===n||void 0===n?void 0:n.getChild());case 18:if(y=e.sent,!this.returnIntermediateSteps){e.next=21;break}return e.abrupt("return",(0,a.Z)((0,a.Z)({},y),{},{intermediateSteps:h}));case 21:return e.abrupt("return",y);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_chainType",value:function(){return"map_reduce_documents_chain"}},{key:"serialize",value:function(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}],[{key:"deserialize",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.llm_chain){e.next=2;break}throw new Error("Missing llm_chain");case 2:if(t.combine_document_chain){e.next=4;break}throw new Error("Missing combine_document_chain");case 4:return e.t0=n,e.next=7,d.LLMChain.deserialize(t.llm_chain);case 7:return e.t1=e.sent,e.next=10,b.l.deserialize(t.combine_document_chain);case 10:return e.t2=e.sent,e.t3={llmChain:e.t1,combineDocumentChain:e.t2},e.abrupt("return",new e.t0(e.t3));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(b.l),k=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,i,a,u,c,o;return(0,s.Z)(this,n),o=t.call(this,e),Object.defineProperty((0,m.Z)(o),"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,m.Z)(o),"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty((0,m.Z)(o),"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty((0,m.Z)(o),"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty((0,m.Z)(o),"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty((0,m.Z)(o),"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,m.Z)(o),"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:o.defaultDocumentPrompt}),o.llmChain=e.llmChain,o.refineLLMChain=e.refineLLMChain,o.documentVariableName=null!==(r=e.documentVariableName)&&void 0!==r?r:o.documentVariableName,o.inputKey=null!==(i=e.inputKey)&&void 0!==i?i:o.inputKey,o.outputKey=null!==(a=e.outputKey)&&void 0!==a?a:o.outputKey,o.documentPrompt=null!==(u=e.documentPrompt)&&void 0!==u?u:o.documentPrompt,o.initialResponseName=null!==(c=e.initialResponseName)&&void 0!==c?c:o.initialResponseName,o}return(0,p.Z)(n,[{key:"defaultDocumentPrompt",get:function(){return new y.PromptTemplate({inputVariables:["page_content"],template:"{page_content}"})}},{key:"inputKeys",get:function(){return[this.inputKey].concat((0,l.Z)(this.refineLLMChain.inputKeys))}},{key:"outputKeys",get:function(){return[this.outputKey]}},{key:"_constructInitialInputs",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t,n){var u,c,o,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(0,a.Z)({page_content:t.pageContent},t.metadata),c={},this.documentPrompt.inputVariables.forEach((function(e){c[e]=u[e]})),e.t0=i.Z,e.t1={},e.t2=this.documentVariableName,e.next=8,this.documentPrompt.format((0,a.Z)({},c));case 8:return e.t3=e.sent,o=(0,e.t0)(e.t1,e.t2,e.t3),l=(0,a.Z)((0,a.Z)({},o),n),e.abrupt("return",l);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_constructRefineInputs",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t,n){var u,c,o,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(0,a.Z)({page_content:t.pageContent},t.metadata),c={},this.documentPrompt.inputVariables.forEach((function(e){c[e]=u[e]})),e.t0=i.Z,e.t1={},e.t2=this.documentVariableName,e.next=8,this.documentPrompt.format((0,a.Z)({},c));case 8:return e.t3=e.sent,o=(0,e.t0)(e.t1,e.t2,e.t3),l=(0,a.Z)((0,i.Z)({},this.initialResponseName,n),o),e.abrupt("return",l);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_call",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t,n){var o,l,s,p,m,h,f,b,d,y;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputKey in t){e.next=2;break}throw new Error("Document key ".concat(this.inputKey," not found."));case 2:return o=this.inputKey,l=t[o],s=(0,u.Z)(t,[o].map(c.Z)),p=l,e.next=6,this._constructInitialInputs(p[0],s);case 6:return m=e.sent,e.next=9,this.llmChain.predict((0,a.Z)({},m),null===n||void 0===n?void 0:n.getChild());case 9:h=e.sent,f=[h],b=1;case 12:if(!(b<p.length)){e.next=24;break}return e.next=15,this._constructRefineInputs(p[b],h);case 15:return d=e.sent,y=(0,a.Z)((0,a.Z)({},d),s),e.next=19,this.refineLLMChain.predict((0,a.Z)({},y),null===n||void 0===n?void 0:n.getChild());case 19:h=e.sent,f.push(h);case 21:b+=1,e.next=12;break;case 24:return e.abrupt("return",(0,i.Z)({},this.outputKey,h));case 25:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_chainType",value:function(){return"refine_documents_chain"}},{key:"serialize",value:function(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}],[{key:"deserialize",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t){var i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.llm_chain){e.next=3;break}throw new Error("Missing llm_chain");case 3:if(a=t.refine_llm_chain){e.next=6;break}throw new Error("Missing refine_llm_chain");case 6:return e.t0=n,e.next=9,d.LLMChain.deserialize(i);case 9:return e.t1=e.sent,e.next=12,d.LLMChain.deserialize(a);case 12:return e.t2=e.sent,e.t3={llmChain:e.t1,refineLLMChain:e.t2},e.abrupt("return",new e.t0(e.t3));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(b.l)}}]);
//# sourceMappingURL=794.cc8c443b.chunk.js.map