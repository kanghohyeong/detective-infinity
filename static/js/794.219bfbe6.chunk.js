"use strict";(self.webpackChunkai_detective=self.webpackChunkai_detective||[]).push([[794],{794:function(e,n,t){t.r(n),t.d(n,{MapReduceDocumentsChain:function(){return Z},RefineDocumentsChain:function(){return _},StuffDocumentsChain:function(){return v}});var r=t(4165),i=t(5861),a=t(4942),u=t(1413),c=t(4925),o=t(9142),l=t(3433),s=t(5671),m=t(3144),p=t(7326),h=t(136),f=t(9388),b=t(4735),d=t(3025),y=t(7593),v=function(e){(0,h.Z)(t,e);var n=(0,f.Z)(t);function t(e){var r,i,a;return(0,s.Z)(this,t),a=n.call(this,e),Object.defineProperty((0,p.Z)(a),"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,p.Z)(a),"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty((0,p.Z)(a),"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),a.llmChain=e.llmChain,a.documentVariableName=null!==(r=e.documentVariableName)&&void 0!==r?r:a.documentVariableName,a.inputKey=null!==(i=e.inputKey)&&void 0!==i?i:a.inputKey,a}return(0,m.Z)(t,[{key:"inputKeys",get:function(){var e=this;return[this.inputKey].concat((0,l.Z)(this.llmChain.inputKeys)).filter((function(n){return n!==e.documentVariableName}))}},{key:"outputKeys",get:function(){return this.llmChain.outputKeys}},{key:"_prepInputs",value:function(e){if(!(this.inputKey in e))throw new Error("Document key ".concat(this.inputKey," not found."));var n=this.inputKey,t=e[n],r=(0,c.Z)(e,[n].map(o.Z)),i=t.map((function(e){return e.pageContent})).join("\n\n");return(0,u.Z)((0,u.Z)({},r),{},(0,a.Z)({},this.documentVariableName,i))}},{key:"_call",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.llmChain.call(this._prepInputs(n),null===t||void 0===t?void 0:t.getChild("combine_documents"));case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"_chainType",value:function(){return"stuff_documents_chain"}},{key:"serialize",value:function(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}],[{key:"lc_name",value:function(){return"StuffDocumentsChain"}},{key:"deserialize",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.llm_chain){e.next=2;break}throw new Error("Missing llm_chain");case 2:return e.t0=t,e.next=5,y.LLMChain.deserialize(n.llm_chain);case 5:return e.t1=e.sent,e.t2={llmChain:e.t1},e.abrupt("return",new e.t0(e.t2));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}]),t}(d.l),Z=function(e){(0,h.Z)(t,e);var n=(0,f.Z)(t);function t(e){var r,i,a,u,c,o,l;return(0,s.Z)(this,t),l=n.call(this,e),Object.defineProperty((0,p.Z)(l),"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,p.Z)(l),"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty((0,p.Z)(l),"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty((0,p.Z)(l),"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty((0,p.Z)(l),"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty((0,p.Z)(l),"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty((0,p.Z)(l),"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty((0,p.Z)(l),"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),l.llmChain=e.llmChain,l.combineDocumentChain=e.combineDocumentChain,l.documentVariableName=null!==(r=e.documentVariableName)&&void 0!==r?r:l.documentVariableName,l.ensureMapStep=null!==(i=e.ensureMapStep)&&void 0!==i?i:l.ensureMapStep,l.inputKey=null!==(a=e.inputKey)&&void 0!==a?a:l.inputKey,l.maxTokens=null!==(u=e.maxTokens)&&void 0!==u?u:l.maxTokens,l.maxIterations=null!==(c=e.maxIterations)&&void 0!==c?c:l.maxIterations,l.returnIntermediateSteps=null!==(o=e.returnIntermediateSteps)&&void 0!==o&&o,l}return(0,m.Z)(t,[{key:"inputKeys",get:function(){return[this.inputKey].concat((0,l.Z)(this.combineDocumentChain.inputKeys))}},{key:"outputKeys",get:function(){return this.combineDocumentChain.outputKeys}},{key:"_call",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t){var i,l,s,m,p,h,f,b,d,y=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputKey in n){e.next=2;break}throw new Error("Document key ".concat(this.inputKey," not found."));case 2:i=this.inputKey,l=n[i],s=(0,c.Z)(n,[i].map(o.Z)),m=l,p=[],h=(0,r.Z)().mark((function e(){var n,i,c,o,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.map((function(e){return(0,u.Z)((0,a.Z)({},y.documentVariableName,e.pageContent),s)})),!(0!==f||!y.ensureMapStep)){e.next=12;break}return e.next=5,y.combineDocumentChain.llmChain.prompt.format(y.combineDocumentChain._prepInputs((0,u.Z)((0,a.Z)({},y.combineDocumentChain.inputKey,m),s)));case 5:return i=e.sent,e.next=8,y.combineDocumentChain.llmChain._getNumTokens(i);case 8:if(c=e.sent,!(c<y.maxTokens)){e.next=12;break}return e.abrupt("return","break");case 12:return e.next=14,y.llmChain.apply(n,t?Array.from({length:n.length},(function(e,n){return t.getChild("map_".concat(n+1))})):void 0);case 14:o=e.sent,l=y.llmChain.outputKey,y.returnIntermediateSteps&&(p=p.concat(o.map((function(e){return e[l]})))),m=o.map((function(e){return{pageContent:e[l],metadata:{}}}));case 18:case"end":return e.stop()}}),e)})),f=0;case 7:if(!(f<this.maxIterations)){e.next=15;break}return e.delegateYield(h(),"t0",9);case 9:if("break"!==e.t0){e.next=12;break}return e.abrupt("break",15);case 12:f+=1,e.next=7;break;case 15:return b=(0,u.Z)((0,a.Z)({},this.combineDocumentChain.inputKey,m),s),e.next=18,this.combineDocumentChain.call(b,null===t||void 0===t?void 0:t.getChild("combine_documents"));case 18:if(d=e.sent,!this.returnIntermediateSteps){e.next=21;break}return e.abrupt("return",(0,u.Z)((0,u.Z)({},d),{},{intermediateSteps:p}));case 21:return e.abrupt("return",d);case 22:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"_chainType",value:function(){return"map_reduce_documents_chain"}},{key:"serialize",value:function(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}],[{key:"lc_name",value:function(){return"MapReduceDocumentsChain"}},{key:"deserialize",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.llm_chain){e.next=2;break}throw new Error("Missing llm_chain");case 2:if(n.combine_document_chain){e.next=4;break}throw new Error("Missing combine_document_chain");case 4:return e.t0=t,e.next=7,y.LLMChain.deserialize(n.llm_chain);case 7:return e.t1=e.sent,e.next=10,v.deserialize(n.combine_document_chain);case 10:return e.t2=e.sent,e.t3={llmChain:e.t1,combineDocumentChain:e.t2},e.abrupt("return",new e.t0(e.t3));case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}]),t}(d.l),_=function(e){(0,h.Z)(t,e);var n=(0,f.Z)(t);function t(e){var r,i,a,u,c,o;return(0,s.Z)(this,t),o=n.call(this,e),Object.defineProperty((0,p.Z)(o),"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,p.Z)(o),"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty((0,p.Z)(o),"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty((0,p.Z)(o),"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty((0,p.Z)(o),"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty((0,p.Z)(o),"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,p.Z)(o),"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:o.defaultDocumentPrompt}),o.llmChain=e.llmChain,o.refineLLMChain=e.refineLLMChain,o.documentVariableName=null!==(r=e.documentVariableName)&&void 0!==r?r:o.documentVariableName,o.inputKey=null!==(i=e.inputKey)&&void 0!==i?i:o.inputKey,o.outputKey=null!==(a=e.outputKey)&&void 0!==a?a:o.outputKey,o.documentPrompt=null!==(u=e.documentPrompt)&&void 0!==u?u:o.documentPrompt,o.initialResponseName=null!==(c=e.initialResponseName)&&void 0!==c?c:o.initialResponseName,o}return(0,m.Z)(t,[{key:"defaultDocumentPrompt",get:function(){return new b.Pf({inputVariables:["page_content"],template:"{page_content}"})}},{key:"inputKeys",get:function(){var e=this;return(0,l.Z)(new Set([this.inputKey].concat((0,l.Z)(this.llmChain.inputKeys),(0,l.Z)(this.refineLLMChain.inputKeys)))).filter((function(n){return n!==e.documentVariableName&&n!==e.initialResponseName}))}},{key:"outputKeys",get:function(){return[this.outputKey]}},{key:"_constructInitialInputs",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t){var i,c,o,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,u.Z)({page_content:n.pageContent},n.metadata),c={},this.documentPrompt.inputVariables.forEach((function(e){c[e]=i[e]})),e.t0=a.Z,e.t1={},e.t2=this.documentVariableName,e.next=8,this.documentPrompt.format((0,u.Z)({},c));case 8:return e.t3=e.sent,o=(0,e.t0)(e.t1,e.t2,e.t3),l=(0,u.Z)((0,u.Z)({},o),t),e.abrupt("return",l);case 12:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"_constructRefineInputs",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t){var i,c,o,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,u.Z)({page_content:n.pageContent},n.metadata),c={},this.documentPrompt.inputVariables.forEach((function(e){c[e]=i[e]})),e.t0=a.Z,e.t1={},e.t2=this.documentVariableName,e.next=8,this.documentPrompt.format((0,u.Z)({},c));case 8:return e.t3=e.sent,o=(0,e.t0)(e.t1,e.t2,e.t3),l=(0,u.Z)((0,a.Z)({},this.initialResponseName,t),o),e.abrupt("return",l);case 12:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"_call",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t){var i,l,s,m,p,h,f,b,d,y;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputKey in n){e.next=2;break}throw new Error("Document key ".concat(this.inputKey," not found."));case 2:return i=this.inputKey,l=n[i],s=(0,c.Z)(n,[i].map(o.Z)),m=l,e.next=6,this._constructInitialInputs(m[0],s);case 6:return p=e.sent,e.next=9,this.llmChain.predict((0,u.Z)({},p),null===t||void 0===t?void 0:t.getChild("answer"));case 9:h=e.sent,f=[h],b=1;case 12:if(!(b<m.length)){e.next=24;break}return e.next=15,this._constructRefineInputs(m[b],h);case 15:return d=e.sent,y=(0,u.Z)((0,u.Z)({},d),s),e.next=19,this.refineLLMChain.predict((0,u.Z)({},y),null===t||void 0===t?void 0:t.getChild("refine"));case 19:h=e.sent,f.push(h);case 21:b+=1,e.next=12;break;case 24:return e.abrupt("return",(0,a.Z)({},this.outputKey,h));case 25:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"_chainType",value:function(){return"refine_documents_chain"}},{key:"serialize",value:function(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}],[{key:"lc_name",value:function(){return"RefineDocumentsChain"}},{key:"deserialize",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.llm_chain){e.next=3;break}throw new Error("Missing llm_chain");case 3:if(a=n.refine_llm_chain){e.next=6;break}throw new Error("Missing refine_llm_chain");case 6:return e.t0=t,e.next=9,y.LLMChain.deserialize(i);case 9:return e.t1=e.sent,e.next=12,y.LLMChain.deserialize(a);case 12:return e.t2=e.sent,e.t3={llmChain:e.t1,refineLLMChain:e.t2},e.abrupt("return",new e.t0(e.t3));case 15:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}]),t}(d.l)}}]);
//# sourceMappingURL=794.219bfbe6.chunk.js.map