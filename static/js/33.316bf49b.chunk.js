"use strict";(self.webpackChunkai_detective=self.webpackChunkai_detective||[]).push([[33],{4033:function(e,t,n){n.r(t),n.d(t,{VectorDBQAChain:function(){return g}});var r=n(4165),o=n(1413),i=n(5861),u=n(5671),a=n(3144),c=n(7326),s=n(136),l=n(9388),f=n(3025),h=n(7593),m=n(794),v=n(4735),p=(n(3854),n(9439)),d=n(7762),b=function(){function e(){(0,u.Z)(this,e)}return(0,a.Z)(e,[{key:"getPromptAsync",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n){var o,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.getPrompt(t),e.abrupt("return",i.partial(null!==(o=null===n||void 0===n?void 0:n.partialVariables)&&void 0!==o?o:{}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),y=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(0,u.Z)(this,n),r=t.call(this),Object.defineProperty((0,c.Z)(r),"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,c.Z)(r),"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),r.defaultPrompt=e,r.conditionals=o,r}return(0,a.Z)(n,[{key:"getPrompt",value:function(e){var t,n=(0,d.Z)(this.conditionals);try{for(n.s();!(t=n.n()).done;){var r=(0,p.Z)(t.value,2),o=r[0],i=r[1];if(o(e))return i}}catch(u){n.e(u)}finally{n.f()}return this.defaultPrompt}}]),n}(b);function w(e){return"base_chat_model"===e._modelType()}var k=new v.Pf({template:"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\n{context}\n\nQuestion: {question}\nHelpful Answer:",inputVariables:["context","question"]}),Z=[v.ov.fromTemplate("Use the following pieces of context to answer the users question. \nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\n----------------\n{context}"),v.kq.fromTemplate("{question}")],_=new y(k,[[w,v.ks.fromMessages(Z)]]);function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.prompt,r=void 0===n?_.getPrompt(e):n,o=t.verbose,i=new h.LLMChain({prompt:r,llm:e,verbose:o});return new m.StuffDocumentsChain({llmChain:i,verbose:o})}var g=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r,o,i,a;return(0,u.Z)(this,n),a=t.call(this,e),Object.defineProperty((0,c.Z)(a),"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty((0,c.Z)(a),"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty((0,c.Z)(a),"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,c.Z)(a),"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty((0,c.Z)(a),"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),a.vectorstore=e.vectorstore,a.combineDocumentsChain=e.combineDocumentsChain,a.inputKey=null!==(r=e.inputKey)&&void 0!==r?r:a.inputKey,a.k=null!==(o=e.k)&&void 0!==o?o:a.k,a.returnSourceDocuments=null!==(i=e.returnSourceDocuments)&&void 0!==i?i:a.returnSourceDocuments,a}return(0,a.Z)(n,[{key:"inputKeys",get:function(){return[this.inputKey]}},{key:"outputKeys",get:function(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}},{key:"_call",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n){var i,u,a,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputKey in t){e.next=2;break}throw new Error("Question key ".concat(this.inputKey," not found."));case 2:return i=t[this.inputKey],e.next=5,this.vectorstore.similaritySearch(i,this.k,t.filter,null===n||void 0===n?void 0:n.getChild("vectorstore"));case 5:return u=e.sent,a={question:i,input_documents:u},e.next=9,this.combineDocumentsChain.call(a,null===n||void 0===n?void 0:n.getChild("combine_documents"));case 9:if(c=e.sent,!this.returnSourceDocuments){e.next=12;break}return e.abrupt("return",(0,o.Z)((0,o.Z)({},c),{},{sourceDocuments:u}));case 12:return e.abrupt("return",c);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_chainType",value:function(){return"vector_db_qa"}},{key:"serialize",value:function(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}}],[{key:"lc_name",value:function(){return"VectorDBQAChain"}},{key:"deserialize",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,o){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("vectorstore"in o){e.next=2;break}throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");case 2:if(i=o.vectorstore,t.combine_documents_chain){e.next=5;break}throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");case 5:return e.t0=n,e.next=8,f.l.deserialize(t.combine_documents_chain);case 8:return e.t1=e.sent,e.t2=t.k,e.t3=i,e.t4={combineDocumentsChain:e.t1,k:e.t2,vectorstore:e.t3},e.abrupt("return",new e.t0(e.t4));case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fromLLM",value:function(e,t,n){var r=D(e);return new this((0,o.Z)({vectorstore:t,combineDocumentsChain:r},n))}}]),n}(f.l)}}]);
//# sourceMappingURL=33.316bf49b.chunk.js.map